/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/helper/imageLink.tsx":
/*!**********************************!*\
  !*** ./src/helper/imageLink.tsx ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   closeImageUrl: () => (/* binding */ closeImageUrl),
/* harmony export */   deleteImageUrl: () => (/* binding */ deleteImageUrl),
/* harmony export */   pauseImageUrl: () => (/* binding */ pauseImageUrl),
/* harmony export */   playImageUrl: () => (/* binding */ playImageUrl),
/* harmony export */   righterImageUrl: () => (/* binding */ righterImageUrl),
/* harmony export */   youTubeIconLink: () => (/* binding */ youTubeIconLink)
/* harmony export */ });
const youTubeIconLink = 'data:image/png;base64,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';
const playImageUrl = '../assets/resource/play.png';
const pauseImageUrl = '../assets/resource/pause.png';
const deleteImageUrl = '../assets/resource/delete.png';
const closeImageUrl = '../assets/resource/close.png';
const righterImageUrl = '../assets/resource/corecte.png';


/***/ }),

/***/ "./src/helper/injectComponent.tsx":
/*!****************************************!*\
  !*** ./src/helper/injectComponent.tsx ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   handleBookMarkPointer: () => (/* binding */ handleBookMarkPointer),
/* harmony export */   handleBookMarkPointerRemover: () => (/* binding */ handleBookMarkPointerRemover),
/* harmony export */   multipleInjectPointer: () => (/* binding */ multipleInjectPointer)
/* harmony export */ });
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
/**
 * Injects a single bookmark pointer into the YouTube video player's progress bar.
 *
 * Given a position (in pixels) in the progress bar, this function creates a
 * new `<div>` element with a yellow background and appends it to the progress
 * bar container at the given position. The element is positioned absolutely
 * and has a top position of 0px to align it with the top of the progress bar.
 * The element is given a z-index of 99 to ensure it appears above the progress
 * bar.
 *
 * @param {number | GLfloat | string} position - The position in pixels to place
 * the bookmark pointer in the progress bar.
 */
const handleBookMarkPointer = (position) => {
    let progressBarContainer = document.querySelector(".ytp-progress-bar-container");
    let dot = document.createElement("div");
    dot.className = "youtube-bookmark-dot";
    dot.style.position = "absolute";
    dot.style.top = "0px"; // Align it to the top of the progress bar
    dot.style.left = `${position}px`; // Place the dot at the correct position
    dot.style.width = "3px"; // Dot size
    dot.style.height = "5px";
    dot.style.backgroundColor = "yellow";
    dot.style.zIndex = "99"; // Ensure it's above the progress bar
    // Append the dot to the progress bar container
    progressBarContainer.appendChild(dot);
};
/**
 * Injects multiple bookmark pointers into the YouTube video player's progress bar.
 *
 * This function iterates over the provided array of bookmark data and injects
 * a bookmark pointer at the correct position if the URL of the current tab
 * matches the URL of the bookmark. It does this by sending a message to the
 * background script to get the current tab URL, and then checks if the URLs
 * match by removing any timestamp parameters from both URLs. If the URLs
 * match, it calls `handleBookMarkPointer` to inject the bookmark pointer.
 * @param {localStorageDataInterface[]} data - An array of bookmark data objects
 */
const multipleInjectPointer = (data) => {
    data.forEach((bookmark) => {
        // Send a message to background script to get the current tab URL
        chrome.runtime.sendMessage({ action: "getCurrentTabUrl" }, (response) => {
            let tabUrl = response.url; // Get the tab URL from the response
            let bookMarkUrl = bookmark.url;
            // Remove any timestamp parameters from both the current tab URL and the bookmark URL
            if (tabUrl === null || tabUrl === void 0 ? void 0 : tabUrl.includes("&t")) {
                tabUrl = tabUrl.split("&t")[0];
            }
            bookMarkUrl = bookMarkUrl.split("&t")[0];
            // Check if the URLs match
            if (tabUrl === bookMarkUrl) {
                handleBookMarkPointer(bookmark.position);
            }
        });
    });
};
/**
 * Asynchronously removes all bookmark pointers from the YouTube video player's progress bar.
 *
 * This function selects all elements with the class name 'youtube-bookmark-dot'
 * and removes them from the DOM. It's used to clear any existing bookmark pointers
 * on the progress bar. The operation is performed asynchronously.
 */
const handleBookMarkPointerRemover = () => __awaiter(void 0, void 0, void 0, function* () {
    // Select all elements with the class 'youtube-bookmark-dot'
    const bookmarkDots = document.querySelectorAll(".youtube-bookmark-dot");
    // Iterate over the NodeList and remove each element
    new Promise((resolve) => {
        bookmarkDots.forEach(dot => {
            dot.remove();
        });
    });
});


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be isolated against other modules in the chunk.
(() => {
/*!****************************************!*\
  !*** ./src/content/content_scripts.ts ***!
  \****************************************/
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   handleStorePointerOnVideoLoad: () => (/* binding */ handleStorePointerOnVideoLoad)
/* harmony export */ });
/* harmony import */ var _helper_imageLink__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../helper/imageLink */ "./src/helper/imageLink.tsx");
/* harmony import */ var _helper_injectComponent__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../helper/injectComponent */ "./src/helper/injectComponent.tsx");
/**
 * Scrapes YouTube video player data (current timestamp, video duration, and seek bar position) and sends it to the background script via chrome.runtime.sendMessage.
 * The data is scraped from the YouTube video player's progress bar and seek bar elements.
 * @returns {void}
 */
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};


/**
 * Scrapes the current YouTube video player data, including timestamp, video duration,
 * and seek bar position, and sends it to the background script.
 *
 * The function retrieves the minimum, maximum, current timestamp, and duration values
 * from the YouTube video player's progress bar. It also calculates the position of the
 * video on the seek bar and uses it to place a bookmark pointer on the progress bar.
 *
 * The scraped data is then sent to the background script using `chrome.runtime.sendMessage`.
 *
 * @returns {void}
 */
/**
 * Scrapes the current YouTube video player data, including timestamp, video duration,
 * and seek bar position, and sends it to the background script.
 *
 * The function retrieves the minimum, maximum, current timestamp, and duration values
 * from the YouTube video player's progress bar. It also calculates the position of the
 * video on the seek bar and uses it to place a bookmark pointer on the progress bar.
 *
 * The scraped data is then sent to the background script using `chrome.runtime.sendMessage`.
 *
 * @returns {void}
 */
const handleDataScraping = () => {
    const data = {
        minValue: "",
        maxValue: "",
        value: "",
        duration: "",
        position: "",
    };
    const timeTrackerElement = document.querySelector('[class="ytp-progress-bar"]');
    if (timeTrackerElement) {
        data.minValue = timeTrackerElement.ariaValueMin || "";
        data.maxValue = timeTrackerElement.ariaValueMax || "";
        data.value = timeTrackerElement.ariaValueNow || "";
        data.duration = timeTrackerElement.ariaValueText || "";
    }
    const positionTrackerElement = document.querySelector('[class^="ytp-play-progress ytp-swatch-background-color"]');
    if (positionTrackerElement) {
        let video = document.querySelector("video");
        let currentTime = video.currentTime;
        let progressBarContainer = document.querySelector(".ytp-progress-bar-container");
        let progressBarWidth = progressBarContainer.offsetWidth;
        let videoDuration = video.duration; // Get the video duration
        let position = (currentTime / videoDuration) * progressBarWidth;
        (0,_helper_injectComponent__WEBPACK_IMPORTED_MODULE_1__.handleBookMarkPointer)(position);
        data.position = position.toString() || "";
    }
    chrome.runtime.sendMessage({ type: "scrapeData", data: data });
};
/**
 * Creates an image element with a YouTube bookmark icon and inserts it into the DOM right after the video controls.
 * The element is inserted as the first child of the element with a class name that starts with "ytp-right-controls".
 * If no such element is found, the element is appended to the end of the parent element.
 */
const handleDocumentMutations = () => {
    const entity = document.querySelector('[class^="ytp-right-controls"]');
    if (entity) {
        const image = document.createElement("img");
        image.src = _helper_imageLink__WEBPACK_IMPORTED_MODULE_0__.youTubeIconLink;
        image.style.marginBottom = "15px";
        image.style.marginRight = "10px";
        image.style.cursor = "pointer";
        image.style.width = "20px";
        image.style.height = "20px";
        image.onclick = () => handleDataScraping();
        const firstChilde = entity.firstChild;
        if (firstChilde) {
            entity.insertBefore(image, firstChilde);
        }
        else {
            entity.appendChild(image);
        }
    }
};
/**
 * Retrieves the youtubeBookmarks array from local Chrome storage and
 * injects bookmarks into the YouTube video player's progress bar.
 * If the data is not present in local storage, no action is taken.
 * This function is called when the popup is opened or when the user
 * navigates to a new YouTube video.
 */
const handleStorePointerOnVideoLoad = () => {
    chrome.storage.local.get("youtubeBookmarks", (result) => {
        if (result.youtubeBookmarks) {
            (0,_helper_injectComponent__WEBPACK_IMPORTED_MODULE_1__.multipleInjectPointer)(result.youtubeBookmarks);
        }
    });
};
handleStorePointerOnVideoLoad();
handleDocumentMutations();
//created for listen updated book mark pointer
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => __awaiter(void 0, void 0, void 0, function* () {
    if (message.type == "removePointerContentScript") {
        yield (0,_helper_injectComponent__WEBPACK_IMPORTED_MODULE_1__.handleBookMarkPointerRemover)();
        if (message.data.length > 0) {
            (0,_helper_injectComponent__WEBPACK_IMPORTED_MODULE_1__.multipleInjectPointer)(message.data);
        }
        sendResponse({ message: "success" });
    }
    else if (message.type == "urlChanged") {
        yield (0,_helper_injectComponent__WEBPACK_IMPORTED_MODULE_1__.handleBookMarkPointerRemover)();
        handleStorePointerOnVideoLoad();
    }
}));

})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0EsWUFBWSw4RUFBcUI7QUFDakM7QUFDQSx1QkFBdUIsb0JBQW9CO0FBQzNDO0FBQ0E7QUFDQSxjQUFjLHFGQUE0QjtBQUMxQztBQUNBO0FBQ0EsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9oZWxwZXIvaW1hZ2VMaW5rLnRzeCIsIndlYnBhY2s6Ly8vLi9zcmMvaGVscGVyL2luamVjdENvbXBvbmVudC50c3giLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbnRlbnQvY29udGVudF9zY3JpcHRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCB5b3VUdWJlSWNvbkxpbmsgPSAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFMd0FBQUNVQ0FNQUFBQWVhTFBDQUFBQXlWQk1WRVgvLy8vL0xrMGVGMGtkRmtvZ0ZrdXpzcjBTRWpUeU1FMFRGRWx2SGtvQUFBRDcrL3NSRlVsQUZrbllMVTcvLy8wQUFERUFFa2dBQUN1dHJMUHU3ZklWQzBhN3VjVVZGUzMxOWZlam9hMEFBQkljSENmL05sQWZFMHNGQURveEwwTU5BemdvRmtoZ0cwblFMRTJzSjA2VklVa0lFRXBLR0VuZ01FeFhGMGd4RmtnUkJqMDhQRk1BQUNkMGMzcTRLRXlRa0pMQ3djY0FGRVJVVkdIaDRPWFIwTmdBQUNFUkFFTWVHenFFZ3BGbFpIV1BKRTVKU1ZvQUFCbVhscDlBUGs4bUpUOTdIVWpCS1Vtd1BWRjFBQUFFNzBsRVFWUjRuTzJjRFZmYU1CU0dZNUxaWWl1bElLNnlWcENQQW5iQ0VCRFlHSXIvLzBmdEptM3AvRUsybGRETys1NkRxTFQxNmVYbUppL0hYRUpRS0JRS2hVS2hVQ2pVaDVLeEJ5bkF0a0JHcFg2U3V1b1ZRMXg3N3pkd1VXc3d6bEpXbzNheGQzQ0l6ZG1YS3FkcHMxTmUvWEpHOWh4NXVQejVaMFlwVDFsd3hjL24rNFlIZlRybWtEWHc1K0FlMHBBSWhiamc4YWQ5azhmd0hpUk9TcmtqcnVRcGhSY1JNMU9TZUFkVndrT3c2TlZwU3JxaTRqMVVDbTgyVzhWVTFHcWFhdUU1bzNwQk8wcEZXa0duYWdjc3dpUDhuOE96dE9GeHdDSTh3aU04d21jS0h1djg3L0NZTmg4Q25xY0x6ekh5dThMVGRPR1ZHdkI4Uno3UE9aL3ZTUXB6UG9ISFNRcmhFUjdoRVI3aEVSN2hFZjVEd3VmWmpPUTc4cmsySTVnMkNUeFdHNFJIZUlSSGVJUkhlSVJIK0wrRngxVmxBbzltWkdmNFhFY2VjejZCeDFLSjhQOEJ2QnMrb3FlY3dXdXVxN1U3bmJaNHpoMjg2eFlMdm0zN2hhS2J2OGdmRmJzMjFHOXFkNHZiajhzZ3ZOdjI1VDl6d0lGKzI5Mlc5OW1EMXpxMnp1VUdRczUxdTZQbENiNVhzSk05WUpUYWhkNlcrOHdZZkt0dmk0VmlKRTY1M1c5bEhWNldGZGQxaDllbVNKZDQ4NTlJSC9ONjZFWXZaeFErdklPamptNktkYWRZOVhzZWpiNDFienR2NUgxV3pJaW9LaHFrdTl6Z0NzRVB2bjROeExOTWY3K2d2VnAxTW1SR2luMC8zQ0lLUjl3TUpwUEJqUzd2Qkc3WDc3OWE4VE5qUnR3aHpFeGlqeWc4Z3RJM2h4RG5XeWtJZjRhaTB4MitramtaTUNPdUhJb2RUNWM3WEdHWUJzY3J1YVBlV0IwSGNzc3V2S0I3bmZEUTdPVzhHLzJIcE1EM0xoOUc4UW1qaDBzdi9qMmM1VDRyT05uSStkN3BMZVBock1UTDR3a2hja2MzZkptTXkxenVlUVhHMjlQbjgxVUdTaVZVOTFQVG8rRyszS0EwT0FQcUNONGlad09SK0V4dU9UYXZIek1GTDlKQWEzTXozdEU5bTYrZW43UjZtSVhERnVhcnEvWVRoM0xveUlQZktIQ1RSaDBNU3Zmbnh0TW1BSlpsbk4rWHd0UmgxT1JyN2JlOFB6aDhyK25UQ0kzZkxLY2t5dmNOUER5bXkzSTRXVkdtMjgxZVp1QmQ4QjF4VW5oM1k0ZTg2TDRnZm5iR2QxN2NLOERzRmpPU05vbnZFT20rZVB2TXhYeEd2WTFEaWZQK29QQ0o3NkRzc2w1eDN1cVZZbGxPcFg0WnZqK2hRM0VQSG5ud0hUU2FnbmhwUE5wNnFqVWFsM2pjWndJY3lxRWpYK3pIbm9ueTJ2ZUpZYnpkYkVTOEpaUHZ0WVErWEtpcFg5dHdac3FKZnNoTVdMVkwzMUU5V1Roa2U1c1VvSGNXSjFVNVdjRkszMlNQc3NxSzViL1N0WTJFUC9waG05SnF3Q296bUZmSXl6THpBcDZReWp5ZzBVbW0vVU5FSHU1ZkpUekVEdUMxdFMxR3F2UWRqZVhJc3Q0SlBBa3IvbWpaaUJ3S3AvNjZCMmtqRWs5cHpwdnJWak95MmNEeGN6QWx4bnVCbDYvREVkUEJ6OWlhVTcvWld1dE04YXFTc1c3ZkRwZnVqSWErZzVCZElpOE9lZUpRK2wxeEcycHpudXQ2OUtrTURjb3I1OCt1NGF6S2lVUFJ1ZUxJMDgzbk10U2IxVWZ2aC95cExES3F6MktId2hVMzU1RzFNV0pQZk1mdUNoMUtSRTlWdzIvNk1RV054SGZzcnRDaE5JTE5aNExLNGNWNHE4NVhmOTI0emxqTk53NUZhWjJQZlVmOXVlL1lYY0toMUV0c3N6QlNISGwrYy8vQ2Qrd3U2VkR1STRlaWVHM0RPQXhWZy94RHMwQnhxZ0hEVmxua1pmczdVUjBvMytvN2R0ZmlvUnArNkxELzluZHg0MEZLaGUvNDk3OEd5OHpJb1Nob1BDaDBVUXNvdTF0T1UrcVBhVXlYWUc3VnRIeU1tbTB1SnU4dnczYThJSmtzMURYYmxHMU9NMzVCRkFxRlFxRlFLQlFLbFhYOUF2ZE9vVmYzV2tkZEFBQUFBRWxGVGtTdVFtQ0MnO1xuZXhwb3J0IGNvbnN0IHBsYXlJbWFnZVVybCA9ICcuLi9hc3NldHMvcmVzb3VyY2UvcGxheS5wbmcnO1xuZXhwb3J0IGNvbnN0IHBhdXNlSW1hZ2VVcmwgPSAnLi4vYXNzZXRzL3Jlc291cmNlL3BhdXNlLnBuZyc7XG5leHBvcnQgY29uc3QgZGVsZXRlSW1hZ2VVcmwgPSAnLi4vYXNzZXRzL3Jlc291cmNlL2RlbGV0ZS5wbmcnO1xuZXhwb3J0IGNvbnN0IGNsb3NlSW1hZ2VVcmwgPSAnLi4vYXNzZXRzL3Jlc291cmNlL2Nsb3NlLnBuZyc7XG5leHBvcnQgY29uc3QgcmlnaHRlckltYWdlVXJsID0gJy4uL2Fzc2V0cy9yZXNvdXJjZS9jb3JlY3RlLnBuZyc7XG4iLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbi8qKlxuICogSW5qZWN0cyBhIHNpbmdsZSBib29rbWFyayBwb2ludGVyIGludG8gdGhlIFlvdVR1YmUgdmlkZW8gcGxheWVyJ3MgcHJvZ3Jlc3MgYmFyLlxuICpcbiAqIEdpdmVuIGEgcG9zaXRpb24gKGluIHBpeGVscykgaW4gdGhlIHByb2dyZXNzIGJhciwgdGhpcyBmdW5jdGlvbiBjcmVhdGVzIGFcbiAqIG5ldyBgPGRpdj5gIGVsZW1lbnQgd2l0aCBhIHllbGxvdyBiYWNrZ3JvdW5kIGFuZCBhcHBlbmRzIGl0IHRvIHRoZSBwcm9ncmVzc1xuICogYmFyIGNvbnRhaW5lciBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24uIFRoZSBlbGVtZW50IGlzIHBvc2l0aW9uZWQgYWJzb2x1dGVseVxuICogYW5kIGhhcyBhIHRvcCBwb3NpdGlvbiBvZiAwcHggdG8gYWxpZ24gaXQgd2l0aCB0aGUgdG9wIG9mIHRoZSBwcm9ncmVzcyBiYXIuXG4gKiBUaGUgZWxlbWVudCBpcyBnaXZlbiBhIHotaW5kZXggb2YgOTkgdG8gZW5zdXJlIGl0IGFwcGVhcnMgYWJvdmUgdGhlIHByb2dyZXNzXG4gKiBiYXIuXG4gKlxuICogQHBhcmFtIHtudW1iZXIgfCBHTGZsb2F0IHwgc3RyaW5nfSBwb3NpdGlvbiAtIFRoZSBwb3NpdGlvbiBpbiBwaXhlbHMgdG8gcGxhY2VcbiAqIHRoZSBib29rbWFyayBwb2ludGVyIGluIHRoZSBwcm9ncmVzcyBiYXIuXG4gKi9cbmV4cG9ydCBjb25zdCBoYW5kbGVCb29rTWFya1BvaW50ZXIgPSAocG9zaXRpb24pID0+IHtcbiAgICBsZXQgcHJvZ3Jlc3NCYXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnl0cC1wcm9ncmVzcy1iYXItY29udGFpbmVyXCIpO1xuICAgIGxldCBkb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGRvdC5jbGFzc05hbWUgPSBcInlvdXR1YmUtYm9va21hcmstZG90XCI7XG4gICAgZG90LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIGRvdC5zdHlsZS50b3AgPSBcIjBweFwiOyAvLyBBbGlnbiBpdCB0byB0aGUgdG9wIG9mIHRoZSBwcm9ncmVzcyBiYXJcbiAgICBkb3Quc3R5bGUubGVmdCA9IGAke3Bvc2l0aW9ufXB4YDsgLy8gUGxhY2UgdGhlIGRvdCBhdCB0aGUgY29ycmVjdCBwb3NpdGlvblxuICAgIGRvdC5zdHlsZS53aWR0aCA9IFwiM3B4XCI7IC8vIERvdCBzaXplXG4gICAgZG90LnN0eWxlLmhlaWdodCA9IFwiNXB4XCI7XG4gICAgZG90LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XG4gICAgZG90LnN0eWxlLnpJbmRleCA9IFwiOTlcIjsgLy8gRW5zdXJlIGl0J3MgYWJvdmUgdGhlIHByb2dyZXNzIGJhclxuICAgIC8vIEFwcGVuZCB0aGUgZG90IHRvIHRoZSBwcm9ncmVzcyBiYXIgY29udGFpbmVyXG4gICAgcHJvZ3Jlc3NCYXJDb250YWluZXIuYXBwZW5kQ2hpbGQoZG90KTtcbn07XG4vKipcbiAqIEluamVjdHMgbXVsdGlwbGUgYm9va21hcmsgcG9pbnRlcnMgaW50byB0aGUgWW91VHViZSB2aWRlbyBwbGF5ZXIncyBwcm9ncmVzcyBiYXIuXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpdGVyYXRlcyBvdmVyIHRoZSBwcm92aWRlZCBhcnJheSBvZiBib29rbWFyayBkYXRhIGFuZCBpbmplY3RzXG4gKiBhIGJvb2ttYXJrIHBvaW50ZXIgYXQgdGhlIGNvcnJlY3QgcG9zaXRpb24gaWYgdGhlIFVSTCBvZiB0aGUgY3VycmVudCB0YWJcbiAqIG1hdGNoZXMgdGhlIFVSTCBvZiB0aGUgYm9va21hcmsuIEl0IGRvZXMgdGhpcyBieSBzZW5kaW5nIGEgbWVzc2FnZSB0byB0aGVcbiAqIGJhY2tncm91bmQgc2NyaXB0IHRvIGdldCB0aGUgY3VycmVudCB0YWIgVVJMLCBhbmQgdGhlbiBjaGVja3MgaWYgdGhlIFVSTHNcbiAqIG1hdGNoIGJ5IHJlbW92aW5nIGFueSB0aW1lc3RhbXAgcGFyYW1ldGVycyBmcm9tIGJvdGggVVJMcy4gSWYgdGhlIFVSTHNcbiAqIG1hdGNoLCBpdCBjYWxscyBgaGFuZGxlQm9va01hcmtQb2ludGVyYCB0byBpbmplY3QgdGhlIGJvb2ttYXJrIHBvaW50ZXIuXG4gKiBAcGFyYW0ge2xvY2FsU3RvcmFnZURhdGFJbnRlcmZhY2VbXX0gZGF0YSAtIEFuIGFycmF5IG9mIGJvb2ttYXJrIGRhdGEgb2JqZWN0c1xuICovXG5leHBvcnQgY29uc3QgbXVsdGlwbGVJbmplY3RQb2ludGVyID0gKGRhdGEpID0+IHtcbiAgICBkYXRhLmZvckVhY2goKGJvb2ttYXJrKSA9PiB7XG4gICAgICAgIC8vIFNlbmQgYSBtZXNzYWdlIHRvIGJhY2tncm91bmQgc2NyaXB0IHRvIGdldCB0aGUgY3VycmVudCB0YWIgVVJMXG4gICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHsgYWN0aW9uOiBcImdldEN1cnJlbnRUYWJVcmxcIiB9LCAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIGxldCB0YWJVcmwgPSByZXNwb25zZS51cmw7IC8vIEdldCB0aGUgdGFiIFVSTCBmcm9tIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgbGV0IGJvb2tNYXJrVXJsID0gYm9va21hcmsudXJsO1xuICAgICAgICAgICAgLy8gUmVtb3ZlIGFueSB0aW1lc3RhbXAgcGFyYW1ldGVycyBmcm9tIGJvdGggdGhlIGN1cnJlbnQgdGFiIFVSTCBhbmQgdGhlIGJvb2ttYXJrIFVSTFxuICAgICAgICAgICAgaWYgKHRhYlVybCA9PT0gbnVsbCB8fCB0YWJVcmwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRhYlVybC5pbmNsdWRlcyhcIiZ0XCIpKSB7XG4gICAgICAgICAgICAgICAgdGFiVXJsID0gdGFiVXJsLnNwbGl0KFwiJnRcIilbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBib29rTWFya1VybCA9IGJvb2tNYXJrVXJsLnNwbGl0KFwiJnRcIilbMF07XG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgVVJMcyBtYXRjaFxuICAgICAgICAgICAgaWYgKHRhYlVybCA9PT0gYm9va01hcmtVcmwpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVCb29rTWFya1BvaW50ZXIoYm9va21hcmsucG9zaXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn07XG4vKipcbiAqIEFzeW5jaHJvbm91c2x5IHJlbW92ZXMgYWxsIGJvb2ttYXJrIHBvaW50ZXJzIGZyb20gdGhlIFlvdVR1YmUgdmlkZW8gcGxheWVyJ3MgcHJvZ3Jlc3MgYmFyLlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gc2VsZWN0cyBhbGwgZWxlbWVudHMgd2l0aCB0aGUgY2xhc3MgbmFtZSAneW91dHViZS1ib29rbWFyay1kb3QnXG4gKiBhbmQgcmVtb3ZlcyB0aGVtIGZyb20gdGhlIERPTS4gSXQncyB1c2VkIHRvIGNsZWFyIGFueSBleGlzdGluZyBib29rbWFyayBwb2ludGVyc1xuICogb24gdGhlIHByb2dyZXNzIGJhci4gVGhlIG9wZXJhdGlvbiBpcyBwZXJmb3JtZWQgYXN5bmNocm9ub3VzbHkuXG4gKi9cbmV4cG9ydCBjb25zdCBoYW5kbGVCb29rTWFya1BvaW50ZXJSZW1vdmVyID0gKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgLy8gU2VsZWN0IGFsbCBlbGVtZW50cyB3aXRoIHRoZSBjbGFzcyAneW91dHViZS1ib29rbWFyay1kb3QnXG4gICAgY29uc3QgYm9va21hcmtEb3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi55b3V0dWJlLWJvb2ttYXJrLWRvdFwiKTtcbiAgICAvLyBJdGVyYXRlIG92ZXIgdGhlIE5vZGVMaXN0IGFuZCByZW1vdmUgZWFjaCBlbGVtZW50XG4gICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgYm9va21hcmtEb3RzLmZvckVhY2goZG90ID0+IHtcbiAgICAgICAgICAgIGRvdC5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiLyoqXG4gKiBTY3JhcGVzIFlvdVR1YmUgdmlkZW8gcGxheWVyIGRhdGEgKGN1cnJlbnQgdGltZXN0YW1wLCB2aWRlbyBkdXJhdGlvbiwgYW5kIHNlZWsgYmFyIHBvc2l0aW9uKSBhbmQgc2VuZHMgaXQgdG8gdGhlIGJhY2tncm91bmQgc2NyaXB0IHZpYSBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZS5cbiAqIFRoZSBkYXRhIGlzIHNjcmFwZWQgZnJvbSB0aGUgWW91VHViZSB2aWRlbyBwbGF5ZXIncyBwcm9ncmVzcyBiYXIgYW5kIHNlZWsgYmFyIGVsZW1lbnRzLlxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuaW1wb3J0IHsgeW91VHViZUljb25MaW5rIH0gZnJvbSBcIi4uL2hlbHBlci9pbWFnZUxpbmtcIjtcbmltcG9ydCB7IGhhbmRsZUJvb2tNYXJrUG9pbnRlciwgaGFuZGxlQm9va01hcmtQb2ludGVyUmVtb3ZlciwgbXVsdGlwbGVJbmplY3RQb2ludGVyLCB9IGZyb20gXCIuLi9oZWxwZXIvaW5qZWN0Q29tcG9uZW50XCI7XG4vKipcbiAqIFNjcmFwZXMgdGhlIGN1cnJlbnQgWW91VHViZSB2aWRlbyBwbGF5ZXIgZGF0YSwgaW5jbHVkaW5nIHRpbWVzdGFtcCwgdmlkZW8gZHVyYXRpb24sXG4gKiBhbmQgc2VlayBiYXIgcG9zaXRpb24sIGFuZCBzZW5kcyBpdCB0byB0aGUgYmFja2dyb3VuZCBzY3JpcHQuXG4gKlxuICogVGhlIGZ1bmN0aW9uIHJldHJpZXZlcyB0aGUgbWluaW11bSwgbWF4aW11bSwgY3VycmVudCB0aW1lc3RhbXAsIGFuZCBkdXJhdGlvbiB2YWx1ZXNcbiAqIGZyb20gdGhlIFlvdVR1YmUgdmlkZW8gcGxheWVyJ3MgcHJvZ3Jlc3MgYmFyLiBJdCBhbHNvIGNhbGN1bGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoZVxuICogdmlkZW8gb24gdGhlIHNlZWsgYmFyIGFuZCB1c2VzIGl0IHRvIHBsYWNlIGEgYm9va21hcmsgcG9pbnRlciBvbiB0aGUgcHJvZ3Jlc3MgYmFyLlxuICpcbiAqIFRoZSBzY3JhcGVkIGRhdGEgaXMgdGhlbiBzZW50IHRvIHRoZSBiYWNrZ3JvdW5kIHNjcmlwdCB1c2luZyBgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2VgLlxuICpcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG4vKipcbiAqIFNjcmFwZXMgdGhlIGN1cnJlbnQgWW91VHViZSB2aWRlbyBwbGF5ZXIgZGF0YSwgaW5jbHVkaW5nIHRpbWVzdGFtcCwgdmlkZW8gZHVyYXRpb24sXG4gKiBhbmQgc2VlayBiYXIgcG9zaXRpb24sIGFuZCBzZW5kcyBpdCB0byB0aGUgYmFja2dyb3VuZCBzY3JpcHQuXG4gKlxuICogVGhlIGZ1bmN0aW9uIHJldHJpZXZlcyB0aGUgbWluaW11bSwgbWF4aW11bSwgY3VycmVudCB0aW1lc3RhbXAsIGFuZCBkdXJhdGlvbiB2YWx1ZXNcbiAqIGZyb20gdGhlIFlvdVR1YmUgdmlkZW8gcGxheWVyJ3MgcHJvZ3Jlc3MgYmFyLiBJdCBhbHNvIGNhbGN1bGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoZVxuICogdmlkZW8gb24gdGhlIHNlZWsgYmFyIGFuZCB1c2VzIGl0IHRvIHBsYWNlIGEgYm9va21hcmsgcG9pbnRlciBvbiB0aGUgcHJvZ3Jlc3MgYmFyLlxuICpcbiAqIFRoZSBzY3JhcGVkIGRhdGEgaXMgdGhlbiBzZW50IHRvIHRoZSBiYWNrZ3JvdW5kIHNjcmlwdCB1c2luZyBgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2VgLlxuICpcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5jb25zdCBoYW5kbGVEYXRhU2NyYXBpbmcgPSAoKSA9PiB7XG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgbWluVmFsdWU6IFwiXCIsXG4gICAgICAgIG1heFZhbHVlOiBcIlwiLFxuICAgICAgICB2YWx1ZTogXCJcIixcbiAgICAgICAgZHVyYXRpb246IFwiXCIsXG4gICAgICAgIHBvc2l0aW9uOiBcIlwiLFxuICAgIH07XG4gICAgY29uc3QgdGltZVRyYWNrZXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2NsYXNzPVwieXRwLXByb2dyZXNzLWJhclwiXScpO1xuICAgIGlmICh0aW1lVHJhY2tlckVsZW1lbnQpIHtcbiAgICAgICAgZGF0YS5taW5WYWx1ZSA9IHRpbWVUcmFja2VyRWxlbWVudC5hcmlhVmFsdWVNaW4gfHwgXCJcIjtcbiAgICAgICAgZGF0YS5tYXhWYWx1ZSA9IHRpbWVUcmFja2VyRWxlbWVudC5hcmlhVmFsdWVNYXggfHwgXCJcIjtcbiAgICAgICAgZGF0YS52YWx1ZSA9IHRpbWVUcmFja2VyRWxlbWVudC5hcmlhVmFsdWVOb3cgfHwgXCJcIjtcbiAgICAgICAgZGF0YS5kdXJhdGlvbiA9IHRpbWVUcmFja2VyRWxlbWVudC5hcmlhVmFsdWVUZXh0IHx8IFwiXCI7XG4gICAgfVxuICAgIGNvbnN0IHBvc2l0aW9uVHJhY2tlckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbY2xhc3NePVwieXRwLXBsYXktcHJvZ3Jlc3MgeXRwLXN3YXRjaC1iYWNrZ3JvdW5kLWNvbG9yXCJdJyk7XG4gICAgaWYgKHBvc2l0aW9uVHJhY2tlckVsZW1lbnQpIHtcbiAgICAgICAgbGV0IHZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcInZpZGVvXCIpO1xuICAgICAgICBsZXQgY3VycmVudFRpbWUgPSB2aWRlby5jdXJyZW50VGltZTtcbiAgICAgICAgbGV0IHByb2dyZXNzQmFyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi55dHAtcHJvZ3Jlc3MtYmFyLWNvbnRhaW5lclwiKTtcbiAgICAgICAgbGV0IHByb2dyZXNzQmFyV2lkdGggPSBwcm9ncmVzc0JhckNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgICAgICAgbGV0IHZpZGVvRHVyYXRpb24gPSB2aWRlby5kdXJhdGlvbjsgLy8gR2V0IHRoZSB2aWRlbyBkdXJhdGlvblxuICAgICAgICBsZXQgcG9zaXRpb24gPSAoY3VycmVudFRpbWUgLyB2aWRlb0R1cmF0aW9uKSAqIHByb2dyZXNzQmFyV2lkdGg7XG4gICAgICAgIGhhbmRsZUJvb2tNYXJrUG9pbnRlcihwb3NpdGlvbik7XG4gICAgICAgIGRhdGEucG9zaXRpb24gPSBwb3NpdGlvbi50b1N0cmluZygpIHx8IFwiXCI7XG4gICAgfVxuICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHsgdHlwZTogXCJzY3JhcGVEYXRhXCIsIGRhdGE6IGRhdGEgfSk7XG59O1xuLyoqXG4gKiBDcmVhdGVzIGFuIGltYWdlIGVsZW1lbnQgd2l0aCBhIFlvdVR1YmUgYm9va21hcmsgaWNvbiBhbmQgaW5zZXJ0cyBpdCBpbnRvIHRoZSBET00gcmlnaHQgYWZ0ZXIgdGhlIHZpZGVvIGNvbnRyb2xzLlxuICogVGhlIGVsZW1lbnQgaXMgaW5zZXJ0ZWQgYXMgdGhlIGZpcnN0IGNoaWxkIG9mIHRoZSBlbGVtZW50IHdpdGggYSBjbGFzcyBuYW1lIHRoYXQgc3RhcnRzIHdpdGggXCJ5dHAtcmlnaHQtY29udHJvbHNcIi5cbiAqIElmIG5vIHN1Y2ggZWxlbWVudCBpcyBmb3VuZCwgdGhlIGVsZW1lbnQgaXMgYXBwZW5kZWQgdG8gdGhlIGVuZCBvZiB0aGUgcGFyZW50IGVsZW1lbnQuXG4gKi9cbmNvbnN0IGhhbmRsZURvY3VtZW50TXV0YXRpb25zID0gKCkgPT4ge1xuICAgIGNvbnN0IGVudGl0eSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tjbGFzc149XCJ5dHAtcmlnaHQtY29udHJvbHNcIl0nKTtcbiAgICBpZiAoZW50aXR5KSB7XG4gICAgICAgIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0geW91VHViZUljb25MaW5rO1xuICAgICAgICBpbWFnZS5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIjE1cHhcIjtcbiAgICAgICAgaW1hZ2Uuc3R5bGUubWFyZ2luUmlnaHQgPSBcIjEwcHhcIjtcbiAgICAgICAgaW1hZ2Uuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XG4gICAgICAgIGltYWdlLnN0eWxlLndpZHRoID0gXCIyMHB4XCI7XG4gICAgICAgIGltYWdlLnN0eWxlLmhlaWdodCA9IFwiMjBweFwiO1xuICAgICAgICBpbWFnZS5vbmNsaWNrID0gKCkgPT4gaGFuZGxlRGF0YVNjcmFwaW5nKCk7XG4gICAgICAgIGNvbnN0IGZpcnN0Q2hpbGRlID0gZW50aXR5LmZpcnN0Q2hpbGQ7XG4gICAgICAgIGlmIChmaXJzdENoaWxkZSkge1xuICAgICAgICAgICAgZW50aXR5Lmluc2VydEJlZm9yZShpbWFnZSwgZmlyc3RDaGlsZGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZW50aXR5LmFwcGVuZENoaWxkKGltYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG4vKipcbiAqIFJldHJpZXZlcyB0aGUgeW91dHViZUJvb2ttYXJrcyBhcnJheSBmcm9tIGxvY2FsIENocm9tZSBzdG9yYWdlIGFuZFxuICogaW5qZWN0cyBib29rbWFya3MgaW50byB0aGUgWW91VHViZSB2aWRlbyBwbGF5ZXIncyBwcm9ncmVzcyBiYXIuXG4gKiBJZiB0aGUgZGF0YSBpcyBub3QgcHJlc2VudCBpbiBsb2NhbCBzdG9yYWdlLCBubyBhY3Rpb24gaXMgdGFrZW4uXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHRoZSBwb3B1cCBpcyBvcGVuZWQgb3Igd2hlbiB0aGUgdXNlclxuICogbmF2aWdhdGVzIHRvIGEgbmV3IFlvdVR1YmUgdmlkZW8uXG4gKi9cbmV4cG9ydCBjb25zdCBoYW5kbGVTdG9yZVBvaW50ZXJPblZpZGVvTG9hZCA9ICgpID0+IHtcbiAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoXCJ5b3V0dWJlQm9va21hcmtzXCIsIChyZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKHJlc3VsdC55b3V0dWJlQm9va21hcmtzKSB7XG4gICAgICAgICAgICBtdWx0aXBsZUluamVjdFBvaW50ZXIocmVzdWx0LnlvdXR1YmVCb29rbWFya3MpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuaGFuZGxlU3RvcmVQb2ludGVyT25WaWRlb0xvYWQoKTtcbmhhbmRsZURvY3VtZW50TXV0YXRpb25zKCk7XG4vL2NyZWF0ZWQgZm9yIGxpc3RlbiB1cGRhdGVkIGJvb2sgbWFyayBwb2ludGVyXG5jaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKG1lc3NhZ2UsIHNlbmRlciwgc2VuZFJlc3BvbnNlKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBpZiAobWVzc2FnZS50eXBlID09IFwicmVtb3ZlUG9pbnRlckNvbnRlbnRTY3JpcHRcIikge1xuICAgICAgICB5aWVsZCBoYW5kbGVCb29rTWFya1BvaW50ZXJSZW1vdmVyKCk7XG4gICAgICAgIGlmIChtZXNzYWdlLmRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbXVsdGlwbGVJbmplY3RQb2ludGVyKG1lc3NhZ2UuZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgc2VuZFJlc3BvbnNlKHsgbWVzc2FnZTogXCJzdWNjZXNzXCIgfSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKG1lc3NhZ2UudHlwZSA9PSBcInVybENoYW5nZWRcIikge1xuICAgICAgICB5aWVsZCBoYW5kbGVCb29rTWFya1BvaW50ZXJSZW1vdmVyKCk7XG4gICAgICAgIGhhbmRsZVN0b3JlUG9pbnRlck9uVmlkZW9Mb2FkKCk7XG4gICAgfVxufSkpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9